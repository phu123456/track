<div style="padding:15px;" align="center">
  <form action="<%= new_maintenance_path %>">
    <button class="btn btn-info" type="submit"><i class="fa fa-plus"></i> Add Maintenance</button>
  </form>
</div>
<table class="my_table table" style="width: 85%" id="myTable">
  <thead class="thead-light">
    <tr>
      <th onclick="sortTable(0)">Vehicle <i class="fa fa-sort" style="font-size:17px;color"></i></th>
      <th onclick="sortTable(1)">Service <i class="fa fa-sort" style="font-size:17px;color"></i></th></th>
      <th onclick="sortTable(2)">Maintenance Due <i class="fa fa-sort" style="font-size:17px;color"></i></th></th>
      <th colspan="4">Option</th>
    </tr>
  </thead>

  <tbody>
    <% @maintenances.each do |maintenance| %>
      <tr>
        <td><%= Vehicle.find(maintenance.vehicle_id).plate %></td>
        <td><%= Service.find(maintenance.service_id).name %></td>
        <td width="45%" id="progressBar<%= maintenance.id %>">
          <div class="progress <%= maintenance.percentage(maintenance.id)%>">
            <div class="progress-bar <%=maintenance.getStatus(maintenance.id)%>" role="progressbar" style="width: <%= maintenance.percentage(maintenance.id)%>%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              <font style="color:black;"> <%= maintenance.percentage(maintenance.id)%>% </font>
            </div>
          </div>
        </td>
        <td><button class="reset" id="<%= maintenance.id %>" name="<%= Service.find(maintenance.service_id).name %>" value="<%= maintenance.vehicle_id %>">Reset</button></td>
        <!-- <td><%= link_to 'Show', maintenance %></td> -->
        <td><%= link_to 'Edit', edit_maintenance_path(maintenance) %></td>
        <td><%= link_to 'Destroy', maintenance, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<!-- <%= link_to 'New Maintenance', new_maintenance_path %> -->

<script>
  $( document ).ready(function() {
      $('.maintenance').addClass('active');
  });

  $(".reset").click(function() {
    id = this.id
    $.ajax({
      type:"GET",
      url:"/maintenances/reset",
      data: {
        id: id,
        attribute_name: this.name,
        email: "<%= current_user.email %>",
        vehicle: this.value
      },
      dataType:"json",
      success: function(data){
        // console.log(data[1])
        document.getElementById("progressBar"+id).innerHTML = '<div class="progress"><div class="'+ data[1] +' role="progressbar" style="width: '+ data[0] +'%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">'+ data[0] +'%</div></div>'
      }
    })
  });
</script>
