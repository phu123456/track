<p id="notice"><%= notice %></p>

<h1>Maintenances</h1>

<table>
  <thead>
    <tr>
      <th>Vehicle</th>
      <th>Service</th>
      <th>maintenance due</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @maintenances.each do |maintenance| %>
      <tr>
        <td><%= Vehicle.find(maintenance.vehicle_id).plate %></td>
        <td><%= Service.find(maintenance.service_id).name %></td>
        <td width="45%" id="progressBar<%= maintenance.id %>">
          <div class="progress">
            <div class="progress-bar <%=maintenance.getStatus(maintenance.id)%>" role="progressbar" style="width: <%= maintenance.percentage(maintenance.id)%>%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
              <font style="color:black;"> <%= maintenance.percentage(maintenance.id)%>% </font>
            </div>
          </div>
        </td>
        <td><button class="reset" id="<%= maintenance.id %>">Reset</button></td>
        <td><%= link_to 'Show', maintenance %></td>
        <td><%= link_to 'Edit', edit_maintenance_path(maintenance) %></td>
        <td><%= link_to 'Destroy', maintenance, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Maintenance', new_maintenance_path %>

<script>
  $(".reset").click(function() {
    id = this.id
    $.ajax({
      type:"GET",
      url:"/maintenances/reset",
      data: {
        id: id
      },
      dataType:"json",
      success: function(data){
        console.log(data[1])
        document.getElementById("progressBar"+id).innerHTML = '<div class="progress"><div class="'+ data[1] +' role="progressbar" style="width: '+ data[0] +'%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">'+ data[0] +'%</div></div>'
      }
    })
  });

</script>
