
<br><br><br>
<div class="center">
  <select id ="my_select">
    <option disabled selected value> -- select vehicle -- </option>
    <%= Vehicle.where("vehicles.plate <> ''").each do |vehicle| %>
        <option id="<%= vehicle.id %>" value="<%= vehicle.category %>"><%= vehicle.plate %> </option>
    <% end %>
  </select>
  <button type="button" id="attach">Save</button
</div>

<div id="svgImg" align="center"></div>

<style>
.center {
    margin: auto;
    text-align: center;
}
</style>
<script>

var category = "4Wheels.svg"
var current_selection;
var current_vehicle_id

category_dict={
     "sleehW4":"<%= asset_path('4Wheels.svg') %>",
     "sleehW6":"<%= asset_path('6Wheels.svg') %>",
     "imeSsleehW8":"<%= asset_path('8WheelsSemi.svg') %>",
     "sleehW10":"<%= asset_path('10Wheels.svg') %>",
     "imeSsleehW21":"<%= asset_path('12WheelsSemi.svg') %>",
     "reliarTsleehW21":"<%= asset_path('12WheelsTrailer.svg') %>"
};

$("#my_select").change(function() {
  current_vehicle_id = $(this).children(":selected").attr("id");
  var category = $(this).children(":selected").attr("value").replace(/[-\-]/g,"").split("").reverse().join("")
  console.log('<object data="' + category_dict[category] + '" type="image/svg+xml" id="svg"></object>')
  document.getElementById('svgImg').innerHTML = '<object data="' + category_dict[category] + '" type="image/svg+xml" id="svg" height=600px; width=550px;></object>'
  var mySVG = document.getElementById("svg");
  var svgDoc;
  mySVG.addEventListener("load",function() {
       svgDoc = mySVG.contentDocument;
       var delta = svgDoc.getElementsByClassName("wheel");
       function selectedWheel() {
         for (var i = 0; i < delta.length; i++) {
           svgDoc.getElementById(delta[i].id).style.setProperty("fill", "white", "");
         }
         svgDoc.getElementById(this.id).style.setProperty("fill", "black", "");
         current_selection = this.id
         console.log(current_selection)
         console.log(current_vehicle_id)
       }
       for (var i = 0; i < delta.length; i++) {
         svgDoc.getElementById(delta[i].id).style.setProperty("fill", "white", "");
         delta[i].addEventListener('click', selectedWheel, false);
       }
  }, false);
});

$("#attach").click(function() {
  $.ajax({
    type:"GET",
    url:"/tyres/attach",
    data: {
      tyre_id: <%= @tyre.id.to_json %>,
      vehicle_id: current_vehicle_id,
      position: current_selection
    },
    dataType:"json",
    success: function(data){
      console.log("done")
    }
  })
});

</script>
